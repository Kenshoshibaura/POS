<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8">
<link rel="apple-touch-icon" href="img/accept.PNG" />
<script type="text/javascript" src="taq.js"></script>
<link rel="stylesheet" href="taq.css" type="text/css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>Accept App</title></head><body>
<span id="Realtime" class="time">00/00(0) 00:00:00</span>
<button type="button" value="ãƒªãƒ­ãƒ¼ãƒ‰" class="reload" onclick="reload()">ãƒªãƒ­ãƒ¼ãƒ‰</button><br>
<br>
<span class="area">
<table class="sticky_table" id="accept"  border="1">
  <thead><tr>
    <th style="width:225px">å—æ³¨ç•ªå·</th>
    <th style="width:225px">çµŒéæ™‚é–“</th>
    <th style="width:150px">å˜å‘³</th>
    <th style="width:150px">ã‚³ã‚³ã‚¢</th>
    <th style="width:150px">æŠ¹èŒ¶</th>
    <th style="width:150px">ç²‰ç³–</th>
    <th style="width:150px">åˆè¨ˆ</th>
    <th style="width:150px">å—æ¸¡ã—</th>
    <th style="width:150px">æ³¨æ–‡</th>
  </tr></thead>
  <tbody id="body"><tr class="hidden" id="hid" style="height:70vh;">
    <td>000</td>
    <td>0åˆ†å‰</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>ã‚ã‚Š</td>
    <td>0</td>
    <td><button type="button" value="å®Œäº†" class="cmp" onclick="completeRow(this)">å®Œäº†</button></td>
    <td><button type="button" value="å‰Šé™¤" class="delete" onclick="deleteRow(this)">å‰Šé™¤</button></td>
  </tr></tbody>
  <thead><tr id="under">
    <th colspan="2">åˆè¨ˆ</th>
    <th>0</th>
    <th>0</th>
    <th>0</th>
    <th></th>
    <th>0</th>
    <th colspan="2"><button onclick ="mute(this)" id="mute"value="muted" >ğŸ”‡ãƒŸãƒ¥ãƒ¼ãƒˆä¸­</button></th>
  </tr></thead>
</table>
</span>
<audio src="pingpong.mp3" preload="auto" id="audio"></audio>
<div class="bg" id="loadicon">
  <div class="loading">
    <p>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šä¸­...</p>
    <div class="way"><div class="round">â—</div></div>
    <button onclick="location.reload();">å†èª­ã¿è¾¼ã¿</button>
  </div>
</div>
<script>
  socket = io.connect('https://socket.taq-system.tk',{query:{"type":"å—ä¿¡"}});
socket.on("connect",function(){setTimeout(function(){document.getElementById("loadicon").style.display="none";banner("æ¥ç¶šå®Œäº†","ã‚µãƒ¼ãƒãƒ¼ã¨æ¥ç¶šãŒå®Œäº†ã—ã¾ã—ãŸ");},500);});
socket.on("disconnect",function(){document.getElementById("loadicon").style.display="block";});

window.onload = setTimeout(function(){
  socket.emit("get_orders","");
},500);
orderData = {};
var initialized = false;
socket.on("get_orders",function(msg){
  banner("åŒæœŸå®Œäº†","ã‚ªãƒ¼ãƒ€ãƒ¼æƒ…å ±ã®åŒæœŸãŒå®Œäº†ã—ã¾ã—ãŸã€‚");
  if(!initialized){
    msg.forEach(function(json){addjson(json);});
    console.log(orderData);
    initialized = true;
  }
  //else ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
  calcTime();
});

function addjson(json){
  var idname = "No"+json.id;
  orderData[idname] = json;
  adddata(json.id);
}

function reload(){
  location.reload();
}
socket.on("order",function(msg){
  var id = "No" + msg.id;
  orderData[id] = msg;
  adddata(msg.id);
  console.log(msg);
  playbeep();
  calcTime();
});
function adddata(order_id){
  var orderNo = "No"+order_id;
  var table=document.getElementById('accept');
  var row_len=table.rows.length;
  row_len--;

  var row=table.insertRow(row_len);
  var cell1=row.insertCell(-1);
  var cell2=row.insertCell(-1);
  var cell3=row.insertCell(-1);
  var cell4=row.insertCell(-1);
  var cell5=row.insertCell(-1);
  var cell6=row.insertCell(-1);
  var cell7=row.insertCell(-1);
  var cell8=row.insertCell(-1);
  var cell9=row.insertCell(-1);
  row.setAttribute("id",orderNo);
  var cmp='<button value="å®Œäº†" class="cmp" onclick="completeRow(this)"/>å®Œäº†</button>';
  var del='<button value="å‰Šé™¤" class="delete" onclick="deleteRow(this)"/>å‰Šé™¤</button>';

  var id=set3fig(orderData[orderNo].id);
  var time=Math.floor(Math.random()*10);
  var menu1=parseInt(orderData[orderNo].item1);
  var menu2=parseInt(orderData[orderNo].item2);
  var menu3=parseInt(orderData[orderNo].item3);

  var sugar=orderData[orderNo].sugar;

  cell1.innerHTML=id;
  cell2.innerHTML=time+"åˆ†å‰";
  cell3.innerHTML=menu1;
  cell4.innerHTML=menu2;
  cell5.innerHTML=menu3;

  if(sugar==1){cell6.innerHTML="Yes";}
  if(sugar==0){cell6.innerHTML="Ã—";}

  cell7.innerHTML=menu1+menu2+menu3;
  cell8.innerHTML=cmp;
  cell9.innerHTML=del;

  sum('accept');
}
function undodata(order_id){
  var orderNo = "No"+order_id;
  var table=document.getElementById('accept');
  var row_len=table.rows.length;
  row_len--;

  var row=table.insertRow(0);
  var cell1=row.insertCell(-1);
  var cell2=row.insertCell(-1);
  var cell3=row.insertCell(-1);
  var cell4=row.insertCell(-1);
  var cell5=row.insertCell(-1);
  var cell6=row.insertCell(-1);
  var cell7=row.insertCell(-1);
  var cell8=row.insertCell(-1);
  var cell9=row.insertCell(-1);
  row.setAttribute("id",orderNo);
  var cmp='<button value="å®Œäº†" class="cmp" onclick="completeRow(this)"/>å®Œäº†</button>';
  var del='<button value="å‰Šé™¤" class="delete" onclick="deleteRow(this)"/>å‰Šé™¤</button>';

  var id=set3fig(orderData[orderNo].id);
  var time=Math.floor(Math.random()*10);
  var menu1=parseInt(orderData[orderNo].item1);
  var menu2=parseInt(orderData[orderNo].item2);
  var menu3=parseInt(orderData[orderNo].item3);

  var sugar=orderData[orderNo].sugar;

  cell1.innerHTML=id;
  cell2.innerHTML=time+"åˆ†å‰";
  cell3.innerHTML=menu1;
  cell4.innerHTML=menu2;
  cell5.innerHTML=menu3;

  if(sugar==1){cell6.innerHTML="Yes";}
  if(sugar==0){cell6.innerHTML="Ã—";}

  cell7.innerHTML=menu1+menu2+menu3;
  cell8.innerHTML=cmp;
  cell9.innerHTML=del;

  sum('accept');
}

var fin = false;
function completeRow(obj){
  showAlert('å®Œäº†ç¢ºèª',"æ³¨æ–‡ç•ªå·"+obj.parentNode.parentNode.id+' ã®æ³¨æ–‡ã‚’å®Œäº†ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ','confirm','completeRow2(document.getElementById("'+obj.parentNode.parentNode.id+'").childNodes[7].childNodes[0])');

}
function completeRow2(obj){
  var tr=obj.parentNode.parentNode.id;
  socket.json.emit("finish",{"id":tr});
  obj.disabled=true;
  obj.style.background="#3a5e77";
  obj.parentNode.parentNode.style.background="rgba(0,0,0,0.5)";
  obj.parentNode.parentNode.children[8].children[0].disabled=true;
  obj.parentNode.parentNode.children[8].children[0].style.background="#772F22";
  sum('accept');
  fin =true;
}
socket.on("finish r",function(msg){
  var id =  msg.id;
  delete orderData[id];
  console.log(id);
  if(document.getElementById(id)){
    if(fin){
    document.getElementById(id).parentNode.deleteRow(document.getElementById(id).sectionRowIndex);
    fin=false;
    }
    else{
      var obj = document.getElementById(id).children[8].children[0];
      obj.value="OK!";
      obj.setAttribute("onclick","okay(this)");
      obj.style.background="#3a5ee7"
      obj.parentNode.parentNode.style.background="rgba(0,0,0,0.5)";
      obj.parentNode.parentNode.children[7].children[0].disabled=true;
      obj.parentNode.parentNode.children[7].children[0].value="ãŠæ¸¡ã—æ¸ˆ";
      obj.parentNode.parentNode.children[7].children[0].style.background="#3a5e77";
    }
  }
  sum('accept');

});
var isdelete =false;

function deleteRow(obj){
  showAlert('ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç¢ºèª',"æ³¨æ–‡ç•ªå·"+obj.parentNode.parentNode.id+' ã®æ³¨æ–‡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ','confirm','deleteRow2(document.getElementById("'+obj.parentNode.parentNode.id+'").childNodes[8].childNodes[0])');

}
function deleteRow2(obj){
  var tr=obj.parentNode.parentNode.id;
  socket.json.emit("delete",{"id":tr});
  obj.disabled=true;
  obj.style.background="#772F22";
  obj.parentNode.parentNode.style.textShadow="1px 1px 0 #555, -1px 1px 0 #555, 1px -1px 0 #555, -1px -1px 0 #555";
  obj.parentNode.parentNode.style.background="rgba(0,0,0,0.5)";
  obj.parentNode.parentNode.children[7].children[0].disabled=true;
  obj.parentNode.parentNode.children[7].children[0].style.background="#3a5e77";
  isdelete= true;
  sum('accept');
}
socket.on("delete r",function(msg){
  var id =  msg.id;
  delete orderData[id];
  if(document.getElementById(id)){
    if(isdelete){
      document.getElementById(id).parentNode.deleteRow(document.getElementById(id).sectionRowIndex);
      isdelete =true;
    }
    else{
      var obj = document.getElementById(id).children[8].children[0];
      obj.value="OK!";
      obj.setAttribute("onclick","okay(this)");
      obj.parentNode.parentNode.style.textShadow="1px 1px 0 #555, -1px 1px 0 #555, 1px -1px 0 #555, -1px -1px 0 #555";
      obj.parentNode.parentNode.style.background="rgba(0,0,0,0.5)";
      obj.parentNode.parentNode.children[7].children[0].disabled=true;
      obj.parentNode.parentNode.children[7].children[0].value="å‰Šé™¤æ¸ˆã¿";
      obj.parentNode.parentNode.children[7].children[0].style.background="#772F22";

    }
  }
  sum('accept');

});
socket.on("info",function(msg){console.log(msg);socket.emit('newinfo',msg);});
socket.on("newinfo",function(msg){
  console.log(msg);
  var id = "No" + msg.id;
  orderData[id] = msg;
  if(document.getElementById(id)==null){
    banner("æ³¨æ–‡æœªå®Œäº†",msg.id+"ç•ªã®ã‚ªãƒ¼ãƒ€ãƒ¼ãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚",msg.id+"ç•ªã®ãŠæ¸¡ã—ãŒã€€<br><s>å®Œäº†</s> â†’ æœªäº†<br>ã«ã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸã€‚<br>é€Ÿã‚„ã‹ã«èª¿ç†ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚");

    adddata(msg.id);
    console.log(msg);
  }
else{

  var cell = document.getElementById(id).childNodes;
  var newid=set3fig(orderData[id].id);
  var time=Math.floor(Math.random()*10);
  var menu1=parseInt(orderData[id].item1);
  var menu2=parseInt(orderData[id].item2);
  var menu3=parseInt(orderData[id].item3);
  var sugar=orderData[id].sugar;

  //æ³¨æ–‡ã®å¤‰åŒ–ã‚’èª¿æŸ»
  console.log(parseInt(cell[2].innerHTML)+","+menu1);
  console.log(parseInt(cell[3].innerHTML)+","+menu2);
  console.log(parseInt(cell[4].innerHTML)+","+menu3);
  var str = msg.id +"ç•ªã®æ³¨æ–‡ã®å¤‰æ›´ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å¤‰æ›´ç‚¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚<br><br>";
  if(parseInt(cell[2].innerHTML)!=menu1) str += "ãƒ—ãƒ¬ãƒ¼ãƒ³:<s>" + cell[2].innerHTML + "</s>ã€€â†’ã€€" + menu1 + "<br>";
  if(parseInt(cell[3].innerHTML)!=menu2) str += "ã‚³ã‚³ã‚¢ã€€:<s>" + cell[3].innerHTML + "</s>ã€€â†’ã€€" + menu2 + "<br>";
  if(parseInt(cell[4].innerHTML)!=menu3) str += "æŠ¹èŒ¶ã€€ã€€:<s>" + cell[4].innerHTML + "</s>ã€€â†’ã€€" + menu3 + "<br>";

  if(cell[5].innerHTML == "Yes" && sugar == 0)str += "ã€€ç²‰ç³–ã€€:<s>Yes</s>ã€€â†’ã€€Ã—<br>";
  if(cell[5].innerHTML == "Ã—" && sugar == 1)str += "ã€€ç²‰ç³–ã€€:<s>Ã—</s>ã€€â†’ã€€Yes<br>";
  str += "<br>é€Ÿã‚„ã‹ã«èª¿ç†ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚";
  banner("æ³¨æ–‡å¤‰æ›´",msg.id+"ç•ªã®æ³¨æ–‡ã«å¤‰æ›´ãŒã‚ã‚Šã¾ã—ãŸã€‚è©³ã—ãã¯ã“ã“ã‚’ã‚¿ãƒƒãƒ—ã€‚",str);


  //
  cell[0].innerHTML=newid;
  cell[1].innerHTML=time+"åˆ†å‰";
  cell[2].innerHTML=menu1;
  cell[3].innerHTML=menu2;
  cell[4].innerHTML=menu3;

  if(sugar==1){cell[5].innerHTML="Yes";}
  if(sugar==0){cell[5].innerHTML="Ã—";}

  cell[6].innerHTML=menu1+menu2+menu3;
}
document.getElementById(id).className = 'change';
setTimeout(function(){document.getElementById(id).className = '';},20000);
    console.log(msg);
    playbeep();
    calcTime();
});
function okay(obj){
  tr=obj.parentNode.parentNode;
  tr.parentNode.deleteRow(tr.sectionRowIndex);
  sum('accept');
}

function sum(id){
  var table=document.getElementById(id);
  var under=document.getElementById('under');
  var row_len=table.rows.length;
  var sum=0;
  var sumall=0;
  for(var i=2;i<5;i++){
    for(var j=2;j<row_len;j++){
      sum+=parseInt(table.rows[j].cells[i].innerHTML);
    }
    under.cells[i-1].innerHTML=sum;
    sumall+=parseInt(sum);
    var sum=0;
  }
  under.cells[5].innerHTML=sumall;
  var listSum = 70- (document.getElementById("body").childNodes.length-1)*7;
  console.log(document.getElementById("hid").style.height);

  document.getElementById("hid").style.height = listSum+"vh";
}

setInterval('showClock()',1000);

var calcTime = function (){
  for(var id_num in orderData){
    let elem = document.getElementById(id_num).children[1];
    let data = orderData[id_num];
    let nowTime = new Date().getTime();
    let prevTime = new Date(data.time).getTime();
    let time = nowTime - prevTime;
    time = (time-(time%60000))/60000;
    elem.innerHTML = time + "åˆ†å‰";
  }
  console.log("TimeCalc");

}
setInterval(calcTime,1000);

window.onload = function(){
  audio = document.getElementById("audio");
  audio.load();
  audio.muted = true;
}
playbeep  =function(){
  setTimeout(function(){
    audio.play();
  },100);
};
var muting;
function mute(obj){
  if(obj.value=="muted"){
    audio.muted=true;
    audio.play();
    obj.innerHTML = "ã€€è¨­å®šä¸­â€¦ã€€";
    obj.value="ok";
    setTimeout(function(){audio.pause();audio.crrentTime=0.0},300);
    muting = setTimeout(function(){audio.muted= false;obj.innerHTML="ğŸµã€€é€šçŸ¥ä¸­ã€€";},500);
  }
  else{
    if(muting) clearTimeout(muting);
    audio.muted = true;
    obj.innerHTML = "ğŸ”‡ãƒŸãƒ¥ãƒ¼ãƒˆä¸­";
    obj.value= "muted";
  }
}
</script>

<style>
@keyframes newinfo{
    0%{background:rgba(255,255,0,0);}
   40%{background:rgba(255,255,0,1);}
   60%{background:rgba(255,255,0,1);}
   90%{backgrouud:rgba(255,255,0,0);}
}
.change{
animation:2s newinfo 30;
}
.sticky_table {
  display:block;
  position: relative;
  overflow-y: scroll;
  overflow-x: hidden;
  width: calc(100vw - 3.0rem);
  height: calc(85vh);
  border-collapse: collapse;
  align:center;
  text-align:center;
  background-color:rgba(47,74,145,0.75);
}

.area{
  position:fixed;
  left:20px;
  top:10%;
}

.sticky_table th,
.sticky_table td {
  height:calc(10vh);
  width:calc(100vw-3.0rem);
  font-size:150%;
  white-space:nowrap;
}
.sticky_table thead {
  background-color:rgba(47,74,145,0.8);
  position: -webkit-sticky;
  position: sticky;
  top: 0;
  bottom: 0;
  white-space:nowrap;
}

.hidden{visibility:collapse;}

.cmp,
.delete{
  display:inline-block;
  text-decoration:none;
  border-bottom:solid 4px #627295;
  color:#000;
  font-weight:600;
  text-align:center;
  vertical-align:middle;
  text-shadow:1px 1px 0 #fff,-1px 1px 0 #fff,1px -1px 0 #fff,-1px -1px 0 #fff;
  border-radius:5px;
  padding:1px;
  height:35px;

}
.cmp,.delete{font-size:90%;}
.cmp{width:90px;}
.delete{width:75px;}
.demo{width:125px;}


#mute{
  z-index:10;
  font-size:100%;
  background:#a9e54d;
  position:center;
  width:90%;
  text-shadow:1px 1px 0 #fff,-1px 1px 0 #fff,1px -1px 0 #fff,-1px -1px 0 #fff;
  border-radius:5px;
  padding:1px;
  font-family:"Gulim",sans-serif;
  font-weight:600;
}

@media screen and (min-width:900px){
  .sticky_table{
    height:calc(85vh);
  }
  .area{top:12%;}
  .sticky_table th,
  .sticky_table td {
    font-size:125%;
    height:calc(8vh);
  }
  .cmp{width:75px;}
  .delete{width:50px;}
  .cmp,.delete{height:30px;}
}
@media screen and (max-width:700px){
  .sticky_table th,
  .sticky_table td {
    font-size:110%;
    height:calc(8vh);
  }
  .cmp{width:80px;}
  .delete{width:60px;}
  .cmp,.delete{height:35px;}
  #mute{font-size:90%;}
}

@media screen and (max-width:600px){
  .sticky_table th,
  .sticky_table td {
    font-size:100%;
    height:calc(8vh);
  }
  .cmp{width:75px;}
  .delete{width:50px;}
  .cmp,.delete{height:30px;}
  #mute{font-size:80%;}
/*  .time{font-size:100%;}
  .reload{font-size:75%; height:30px;}*/
}
/*load*/
.bg{
  position:fixed;
  top:0px;
  right:0px;
  width:100%;
  height:100%;
  background: rgba(0,0,0,0.4);
  z-index:30;
}
.loading{
  color: #FFF;
  position :fixed;
  top: 50%;
  left:50%;
  transform:translate(-50%,-50%);
  text-shadow: none;
  text-align: center;
}
.loading p{
  font-size:150%;
}
.load{
  left:50%;
  width:100px;
  height:100px;
  border-radius: 100px;
}
.way{
  position:static;
  width:100%;
  height:80px;
  vertical-align: middle;
}
.round{
}
.round{
  animation: animation-dash 5s ease-in-out 0s infinite normal;
  transform:translate(-10%,-10%);
  font-size:20px;
  color: rgba(255,255,255,0.1);
  width:auto;
  position:relative;
  vertical-align: middle;
  width:0;
  overflow: visible;
}
.loading button{
  color: white;
  background: rgba(0,0,0,0.2);
  border-radius: 30px;
  outline-color: white;
  padding:10px;
  border: 2px solid white;
  animation: animation-button-appears 10s ease 0s;
}
.loading button:active {
  border-color: #AAA;
  color:#AAA;
  background: rgba(0,0,0,0.4);

}
@keyframes animation-dash {
  0%{left:0px;top:0%; font-size: 20px;color:rgba(255,255,255,0.01);}
  20%{left:50%;top:0%; font-size: 30px;color:rgba(255,255,255,1);}
  50%{left:100%;top:0%; font-size: 20px;color:rgba(255,255,255,0.01);}
  70%{left:50%;top:0%; font-size: 30px;color:rgba(255,255,255,1);}
  100%{left:0%;top:0%; font-size: 20px;color:rgba(255,255,255,0.01);}
}
@keyframes animation-button-appears{
  0%{color: rgba(255,255,255,0);background: rgba(0,0,0,0.0);border-color:rgba(255,255,255,0);pointer-events: none;}
  95%{color: rgba(255,255,255,0);background: rgba(0,0,0,0.0);border-color:rgba(255,255,255,0);pointer-events: none;}
  100%{color: rgba(255,255,255,1);background: rgba(0,0,0,0.2);border-color:rgba(255,255,255,1);pointer-events: auto;}
}

</style>

</body></html>
